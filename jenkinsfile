pipeline {
    agent any

    stages {

        stage('Checkout') {
            steps {
                checkout scm 
            }
        }

        stage('Install py & wheel') {
            steps {
                sh '''
                    version=$(python3 --version 2>&1 | grep -Po '(?<=Python )(.+)')
                    if [ -z "$version" ]
                    then
                        echo "No Python!"
                        sudo apt install -y python3-pip
                        sudo pip3 install wheel
                        python3 -m pip install --upgrade pip
                        pip3 install check-wheel-contents
                    fi
                '''
            }
        }

        stage('Wheel archive') {
            steps {
                sh '''
                sudo apt-get install python3-setuptools
                python3 setup.py -q bdist_wheel
                python3 setup.py -q sdist
                '''
            }
        }

        stage('Archive') {
            steps {
                archiveArtifacts artifacts: '**/*.whl', fingerprint: true, allowEmptyArchive: true, onlyIfSuccessful: true
            }
        }
    }
}