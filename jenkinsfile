pipeline{
    agent any

    stages{

        stage('Checkout'){
            steps{
                checkout scm 
            }
        }

        stage('Install py & wheel'){
            steps{
                sh '''
                    version=$(python3 --version 2>&1 | grep -Po '(?<=Python )(.+)')
                    if [ -z "$version" ]
                    then
                        echo "No Python!"
                        sudo apt install -y python3-pip
                        sudo pip3 install wheel
                        python3 -m pip install --upgrade pip
                        pip3 install check-wheel-contents
                    fi
                '''
            }
        }
        
        stage('Make wheel'){
            steps{
                sh '''

                #!/bin/bash
                DIR="/home/alex0872m/elevator1/elevator-task/wheel-file"

                if [ -d "$DIR" ]
                then
                    ### Take action if $DIR exists ###
                    cd /home/alex0872m/elevator1/elevator-task/wheel-file
                else
                    ###  Control will jump here if $DIR does NOT exists ###
                    cd /home/alex0872m/elevator1/elevator-task
                    mkdir wheel-file
                exit 1
                fi
                '''
            }
        }

        stage('Wheel archive'){
            steps{
                sh '''
                python3 setup.py bdist_wheel -d /home/alex0872m/elevator1/elevator-task/wheel-file
                '''
            }
        }

    }
}